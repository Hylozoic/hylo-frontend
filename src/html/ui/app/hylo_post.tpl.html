<div class="post" analytics-id="{{::post.id}}">

  <a class="user" ui-sref="profile({id: post.user.id})">
    <div back-img="post.user.avatar" class="avatar"></div>
    <div class="name">{{::post.user.name}}</div>
  </a>

  <div class="post-container">
    <span class="post-options dropdown" dropdown ng-show="canEdit">
      <a class="dropdown-toggle" dropdown-toggle><i class="icon-down" title="icon-down-new"></i></a>
      <ul class="dropdown-menu">
        <li>
          <a class="post-option" ui-sref="community.editSeed({community: post.community.slug, seedId: post.id})">Edit</a>
        </li>
        <li>
          <a class="post-option" ng-click="delete()">Delete</a>
        </li>
      </ul>
    </span>

    <div class="post-header">
      <span class="title" ng-bind-html="post.name | richText | unsafe"></span>
      <img ng-if="post.hasMedia" class="full-media" ng-src="{{::post.media[0].url}}"/>
      <a ui-sref="seed({community: post.community.slug, seedId: post.id})"
        ng-if="post.hasMedia" class="media" back-img="::post.media[0].url">
      </a>
      <div ng-if="hasDescription" class="post-description">
        <see-more contents="description" truncated="truncated" expand="showMore()"></see-more>
      </div>
    </div>

    <div class="post-context">
      <span class="post-type" ng-class="::post.type">{{::post.type | uppercase}}</span>
      &nbsp;•&nbsp;
      <a class="timestamp" ui-sref="seed({community: post.community.slug, seedId: post.id})">
        {{::post.creation_date | fromNow}}<!--
      --></a>
      <span class="community">
        in <a ui-sref="community.seeds({community: post.community.slug})">{{::post.community.name}}</a>
      </span>
      &nbsp;•&nbsp; active {{::post.last_updated | fromNow}}
    </div>

    <div class="followers">
      <span ng-if="followers.length > 0 && !onlyAuthorFollowing">
        <!-- Add yourself as a follower -->
        <span ng-if="isFollowing">You</span><span ng-if="isFollowing && followersNotMe.length > 1">, </span>
        <span ng-if="isFollowing && followersNotMe.length == 1"> and </span>

        <!-- List Names -->
        <span ng-repeat="follower in followersNotMe.slice(0, 2)">
          <a class="follower" ui-sref="profile({id: follower.id})" ng-bind="::follower.name"></a><span ng-if="!$last && followersNotMe.length > 2">, </span>
          <span ng-if="!$last && followersNotMe.length == 2"> and </span>
        </span>

        <!-- Make a list of followers -->
        <span ng-if="followersNotMe.length > 2">
          and
          <span class="dropdown" dropdown on-toggle="openFollowers(open)">
            <a class="dropdown-toggle" dropdown-toggle>
              {{followersNotMe.length - 2}} other<span ng-if="followersNotMe.length > 3">s</span>
            </a>
            <ul class="dropdown-menu">
              <li ng-repeat="user in followersNotMe.slice(2)">
                <a class="dropdown-list-user" ui-sref="profile({id: user.id})" ng-if="!user.hide">
                  <div back-img="::user.avatar_url" class="avatar"></div>
                  <div class="name">{{::user.name}}</div>
                </a>
              </li>
            </ul>
          </span>
        </span>
        <span ng-if="isFollowing || followersNotMe.length > 1">have</span><span ng-if="!isFollowing && followersNotMe.length == 1">has</span> joined this seed.
      </span>
    </div>

    <div class="fulfillment" ng-if="post.fulfilled">
      Fulfilled
      <span ng-if="::post.contributors.length > 0">
        with contributions from
        <a class="contributor" ui-sref="profile({id: user.id})" ng-repeat="user in post.contributors.slice(0, 2)">
          <span>{{::user.name}}</span><span ng-show="::!$last && post.contributors.length>1">,</span>
        </a>
        <span ng-if="::post.contributors.length > 2">
          and
          <span class="dropdown" dropdown>
            <a class="dropdown-toggle" dropdown-toggle>
              {{::post.contributors.length - 2}} other<span ng-if="::post.contributors.length > 3">s</span>
            </a>

            <ul class="dropdown-menu">
              <li ng-repeat="user in post.contributors.slice(2)">
                <a class="dropdown-list-user" ui-sref="profile({id: user.id})">
                  <div back-img="::user.avatar_url" class="avatar"></div>
                  <div class="name">{{::user.name}}</div>
                </a>
              </li>
            </ul>
          </span>
        </span>
      </span>
    </div>

    <div class="post-controls">
      <a ng-click="vote()" class="vote" tooltip-popup-delay="500" tooltip-html-unsafe="Show your support and bring this Seed to the attention of others">
        <i ng-if="!post.myVote" class="icon-heart-new"></i>
        <i ng-if="post.myVote" class="icon-heart-new-selected ng-class:{myVote: post.myVote}" ></i>
        <span class="num">{{post.votes}}</span>
      </a>
      <a ng-click="onFollowerIconClick()" tooltip-popup-delay="500" tooltip="Add members you would like to notify about this Seed" class="num-followers" ng-class="{'link-selected': editingFollowers}">
        <i ng-if="!editingFollowers" class="icon-add-member"></i>
        <i ng-if="editingFollowers" class="icon-add-member-selected"></i>
        <span class="num">{{post.followers.length}}</span>
      </a>
      <a ng-click="onCommentIconClick()" tooltip-popup-delay="500" tooltip="Add Comment" class="comment" ng-class="{'link-selected': !isCommentsCollapsed}">
        <i ng-if="isCommentsCollapsed" class="icon-comment"></i>
        <i ng-if="!isCommentsCollapsed" class="icon-comment-selected"></i>
        <span class="num">{{post.numComments}}</span>
      </a>
      <a ng-click="toggleJoinPost()" tooltip-popup-delay="500" tooltip="{{joinPostTooltipText}}" class="join">
        <i ng-if="!isFollowing" class="icon-join"></i>
        <i ng-if="isFollowing" class="icon-leave"></i>
        <span class="num">{{joinPostText | uppercase}}</span>
      </a>
      <div class="fulfill-link" ng-if="isPostOwner() && !post.fulfilled">
        <span ng-click="markFulfilled()">Mark as Fulfilled</span>
      </div>
    </div>

    <div ng-if="editingFollowers" class="add-followers">
      <div class="add-label">Add Members</div>
      <div class="add-tags">
        <tags-input ng-model="followersToAdd"
                    add-from-autocomplete-only="true"
                    display-property="name"
                    key-property="id"
                    replace-spaces-with-dashes="false"
                    placeholder="Search for people by name"
                    template="/ui/shared/ngTagsInput/tag-user.tpl.html">
          <auto-complete source="findMembers($query)"
                         display-property="name"
                         min-length="2"
                         template="/ui/shared/ngTagsInput/autocomplete-user.tpl.html"
          </auto-complete>
        </tags-input>
      </div>
    </div>

    <div class="add-followers-complete" ng-show="followersToAdd.length > 0">
      <button type="button" class="add-followers-btn" ng-click="toggleEditFollowers()" > Done </button>
    </div>
  </div>

  <embedded-comments ng-if="!isCommentsCollapsed" post="post"></embedded-comments>
</div>
